(function(){var t,e,r,n,a,o,i,s,p,u,l,h,d,f,m,v,g,w,y,b={}.hasOwnProperty,k=function(t,e){function r(){this.constructor=t}for(var n in e)b.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};app.views.Application=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return k(e,t),e.prototype.events={"click .toggle-view":"toggleView"},e.prototype.toggleView=function(t){var e,r;return t.preventDefault(),t.stopPropagation(),e=$(t.currentTarget),r=e.attr("href").replace(/^\//,""),$(".toggle-view.active").removeClass("active"),e.addClass("active"),router.navigate(r,!0)},e.prototype.initialize=function(){var t,e,r;return t=function(){return r.mainView&&r.mainView.refreshCodeMirror?r.mainView.refreshCodeMirror():void 0},_.bindAll(this),r=this,this.header=new app.views.Header({model:this.model}),e=_.debounce(t,300),$(window).resize(e)},e.prototype.render=function(){return $(this.header.render().el).prependTo(this.el),this},e.prototype.replaceMainView=function(t,e){return $("body").removeClass().addClass("current-view "+t),"start"!==t&&$("#header").show(),this.mainView?this.mainView.remove():$("#main").empty(),this.mainView=e,$(e.el).appendTo(jQuery("#main"))},e.prototype["static"]=function(){return this.header.render()},e.prototype.posts=function(t,e,r,n){return this.loading("Loading posts ..."),h(t,e,r,n,_.bind(function(t,e){return this.loaded(),t?this.notify("error","The requested resource could not be found."):(this.header.render(),this.replaceMainView("posts",new app.views.Posts({model:e,id:"posts"}).render()))},this))},e.prototype.post=function(t,e,r,n,a,o){return this.loading("Loading post ..."),h(t,e,r,n,_.bind(function(i){return i?this.notify("error","The requested resource could not be found."):(l(t,e,r,n,a,_.bind(function(t,e){var r;return this.loaded(),this.header.render(),t?this.notify("error","The requested resource could not be found."):(e.preview="edit"!==o,e.lang=_.mode(a),this.replaceMainView(window.authenticated?"post":"read-post",new app.views.Post({model:e,id:"post"}).render()),r=this)},this)),this.header.render())},this))},e.prototype.newPost=function(t,e,r,a){return this.loading("Creating file ..."),h(t,e,r,a,_.bind(function(){return n(t,e,r,a,_.bind(function(t,e){return this.loaded(),e.jekyll=_.jekyll(a,e.file),e.preview=!1,e.markdown=_.markdown(e.file),this.replaceMainView("post",new app.views.Post({model:e,id:"post"}).render()),this.mainView._makeDirty(),app.state.file=e.file,this.header.render()},this))},this))},e.prototype.profile=function(t){var e;return e=this,app.state.title=t,this.loading("Loading profile ..."),d(t,function(t,r){return e.header.render(),e.loaded(),r.authenticated=!!window.authenticated,e.replaceMainView("start",new app.views.Profile({id:"start",model:r}).render())})},e.prototype.start=function(){var t;return t=this,app.state.title="",this.header.render(),this.replaceMainView("start",new app.views.Start({id:"start",model:_.extend(this.model,{authenticated:!!window.authenticated})}).render())},e.prototype.notify=function(t,e){return this.header.render(),this.replaceMainView("notification",new app.views.Notification(t,e).render())},e.prototype.loading=function(t){return $("#main").html('<div class="loading"><span>'+t||"Loading ...</span></div>")},e.prototype.loaded=function(){return $("#main .loading").remove()},e}(Backbone.View),app.views.Header=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return k(e,t),e.prototype.id="header",e.prototype.events={"click a.logout":"_logout"},e.prototype._logout=function(){return f(),app.instance.render(),$("#start").length>0?app.instance.start():window.location.reload(),!1},e.prototype.render=function(){return $(this.el).html(app.templates.header(_.extend(this.model,{state:app.state}))),this},e}(Backbone.View),app.views.Notification=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return k(e,t),e.prototype.id="notification",e.prototype.initialize=function(t,e){return this.model={},this.model.type=t,this.model.message=e},e.prototype.render=function(){return $(this.el).html(app.templates.notification(this.model)),this},e}(Backbone.View),app.views.Post=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return k(e,t),e.prototype.id="post",e.prototype.events={"click .save":"_save","click .cancel-save":"_toggleCommit","click .save.confirm":"updateFile","click a.toggle.view":"_toggleView","click a.toggle.meta":"_toggleMeta","change input":"_makeDirty","change #post_published":"updateMetaData","click .delete":"_delete","click .toggle-options":"_toggleOptions"},e.prototype._toggleOptions=function(){return $(".options").toggle(),!1},e.prototype._delete=function(){return confirm("Are you sure you want to delete that file?")&&r(app.state.user,app.state.repo,app.state.branch,this.model.path,this.model.file,_.bind(function(t){return t?alert("Error during deletion. Please wait 30 seconds and try again."):router.navigate([app.state.user,app.state.repo,"tree",app.state.branch].join("/"),!0)},this)),!1},e.prototype.updateURL=function(){var t;return t=_.compact([app.state.user,app.state.repo,this.model.preview?"blob":"edit",app.state.branch,this.model.path,this.model.file]),router.navigate(t.join("/"),!1)},e.prototype._makeDirty=function(){return this.dirty=!0,this.editor&&(this.model.content=this.editor.getValue()),this.metadataEditor&&(this.model.raw_metadata=this.metadataEditor.getValue()),this.$(".button.save").hasClass("saving")?void 0:(this.$(".button.save").html(this.model.writeable?"SAVE":"SUBMIT CHANGE"),this.$(".button.save").removeClass("inactive error"))},e.prototype.showDiff=function(){var t,e,r,n;return r=this.prevContent,n=this.serialize(),t=this.dmp.diff_main(r,n),this.dmp.diff_cleanupSemantic(t),e=this.dmp.diff_prettyHtml(t).replace(/&para;/g,""),$(".diff-wrapper .diff").html(e)},e.prototype._toggleCommit=function(){return this.$(".document-menu").hasClass("commit")||this.$(".commit-message").attr("placeholder","Updated "+$("input.filepath").val()),this.hideMeta(),this.$(".button.save").html(this.$(".document-menu").hasClass("commit")?this.model.writeable?"SAVE":"SUBMIT CHANGE":"COMMIT"),this.$(".button.save").toggleClass("confirm"),this.$(".document-menu").toggleClass("commit"),this.$(".button.cancel-save").toggle(),this.$(".document-menu-content .options").hide(),this.showDiff(),this.$(".surface").toggle(),this.$(".diff-wrapper").toggle(),this.$(".commit-message").focus(),!1},e.prototype._save=function(t){return this.dirty?(this._toggleCommit(),t.preventDefault(),!1):!1},e.prototype._toggleView=function(t){var e;return e=this,this.toggleView($(t.currentTarget).attr("data-view")),_.delay(function(){return e.refreshCodeMirror()},1),!1},e.prototype._toggleMeta=function(t){var e;return e=this,t&&t.preventDefault(),$(".toggle.meta").toggleClass("active"),$(".metadata").toggle(),_.delay(function(){return e.refreshCodeMirror()},1),!1},e.prototype.refreshCodeMirror=function(){return $(".toggle.meta").hasClass("active")?$(".CodeMirror-scroll").height($(".document").height()/2):$(".CodeMirror-scroll").height($(".document").height()),this.editor.refresh(),this.metadataEditor?this.metadataEditor.refresh():void 0},e.prototype.toggleView=function(t){return this.view=t,"preview"===t?(this.model.preview=!0,this.$(".post-content").html(marked(this.model.content))):this.model.preview=!1,this.hideMeta(),this.updateURL(),$(".toggle").removeClass("active"),$(".toggle."+t).addClass("active"),$(".document .surface").removeClass("preview cheatsheet compose"),$(".document .surface").addClass(t)},e.prototype.hideMeta=function(){return $(".toggle.meta").removeClass("active"),$(".metadata").hide()},e.prototype.right=function(){var t;return t=$(".toggle.active").attr("data-view"),"preview"!==t?"compose"===t?this.toggleView("preview"):this.toggleView("compose"):void 0},e.prototype.left=function(){var t;return t=$(".toggle.active").attr("data-view"),"cheatsheet"!==t?"compose"===t?this.toggleView("cheatsheet"):this.toggleView("compose"):void 0},e.prototype.initialize=function(){return this.dmp=new diff_match_patch,this.mode="edit",this.prevContent=this.serialize(),window.shortcutsRegistered?void 0:(key("âŒ˜+s, ctrl+s",_.bind(function(){return this.updateFile(),!1},this)),key("ctrl+shift+right",_.bind(function(){return this.right(),!1},this)),key("ctrl+shift+left",_.bind(function(){return this.left(),!1},this)),key("esc",_.bind(function(){return this.toggleView("compose"),!1},this)),window.shortcutsRegistered=!0)},e.prototype.parseMetadata=function(t){if(t=this.metadataEditor.getValue(),!t)return{};try{return jsyaml.load(t)}catch(e){return null}},e.prototype.updateMetaData=function(){var t,e;return e=function(t,e){var r;return r=/published: (false|true)/,t.match(r)?t.replace(r,"published: "+!!e):t+"\npublished: "+!!e},this.model.jekyll?(this.model.raw_metadata=this.metadataEditor.getValue(),t=this.$("#post_published").prop("checked"),this.model.raw_metadata=e(this.model.raw_metadata,t),this.metadataEditor.setValue(this.model.raw_metadata),t?$("#post").addClass("published"):$("#post").removeClass("published"),!0):!0},e.prototype.updateFilename=function(t,e){var r,n;return r=function(){return n.model.path=app.state.path,n.model.file=app.state.file,app.instance.header.render(),n.updateURL()},n=this,_.validPathname(t)?(app.state.path=this.model.path,app.state.file=_.extractFilename(t)[1],app.state.path=_.extractFilename(t)[0],this.model.persisted?m(app.state.user,app.state.repo,app.state.branch,_.filepath(this.model.path,this.model.file),t,_.bind(function(t){return t||r(),t?e("error"):e(null)},this)):(r(),e(null))):e("error")},e.prototype.serialize=function(){return y(this.model.content,this.model.jekyll?this.model.raw_metadata:null)},e.prototype.updateSaveState=function(t,e){return $(".button.save").html(t).removeClass("inactive error saving").addClass(e)},e.prototype.sendPatch=function(t,e,r,n){var a,o;return a=function(){return o.updateMetaData()?(o.model.content=o.prevContent,o.editor.setValue(o.prevContent),v(app.state.user,app.state.repo,app.state.branch,t,r,n,function(t){return t?(_.delay(function(){return o.$(".button.save").html("SUBMIT CHANGE"),o.$(".button.save").removeClass("error"),o.$(".button.save").addClass("inactive")},3e3),o.updateSaveState("! Try again in 30 seconds","error"),void 0):(o.dirty=!1,o.model.persisted=!0,o.model.file=e,o.updateURL(),o.prevContent=r,o.updateSaveState("CHANGE SUBMITTED","inactive"))})):o.updateSaveState("! Metadata","error")},o=this,o.updateSaveState("SUBMITTING CHANGE ...","inactive saving"),a(),!1},e.prototype.saveFile=function(t,e,r,n){var a,o;return a=function(){return o.updateMetaData()?w(app.state.user,app.state.repo,app.state.branch,t,r,n,function(t){return t?(_.delay(function(){return o._makeDirty()},3e3),o.updateSaveState("! Try again in 30 seconds","error"),void 0):(o.dirty=!1,o.model.persisted=!0,o.model.file=e,o.updateURL(),o.prevContent=r,o.updateSaveState("SAVED","inactive"))}):o.updateSaveState("! Metadata","error")},o=this,o.updateSaveState("SAVING ...","inactive saving"),t===_.filepath(this.model.path,this.model.file)?a():this.updateFilename(t,function(t){return t?o.updateSaveState("! Filename","error"):a()})},e.prototype.updateFile=function(){var t,e,r,n,a,o;return o=this,r=$("input.filepath").val(),e=_.extractFilename(r)[1],t=this.serialize(),n=this.$(".commit-message").val()||this.$(".commit-message").attr("placeholder"),a=this.model.writeable?this.saveFile:this.sendPatch,this.model.content=this.editor.getValue(),a.call(this,r,e,t,n)},e.prototype.keyMap=function(){var t;return t=this,{"Shift-Ctrl-Left":function(){return t.left()},"Shift-Ctrl-Right":function(){return t.right()},"Shift-Ctrl-M":function(){return t._toggleMeta()},"Ctrl-S":function(){return t.updateFile()}}},e.prototype.initEditor=function(){var t;return t=this,setTimeout(function(){return t.model.jekyll&&(t.metadataEditor=CodeMirror($("#raw_metadata")[0],{mode:"yaml",value:t.model.raw_metadata,theme:"prose-dark",lineWrapping:!0,lineNumbers:!0,extraKeys:t.keyMap(),onChange:_.bind(t._makeDirty,t)}),$("#post .metadata").hide()),t.editor=CodeMirror($("#code")[0],{mode:t.model.lang,value:t.model.content,lineWrapping:!0,lineNumbers:!0,extraKeys:t.keyMap(),matchBrackets:!0,theme:"prose-bright",onChange:_.bind(t._makeDirty,t)}),t.refreshCodeMirror()},100)},e.prototype.render=function(){var t;return t=this,$(this.el).html(app.templates.post(_.extend(this.model,{mode:this.mode}))),this.model.published&&$(this.el).addClass("published"),this.initEditor(),this},e}(Backbone.View),app.views.Posts=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return k(e,t),e.prototype.events={"click a.link":"_loading","keyup #search_str":"_search","click a.switch-branch":"_toggleBranchSelection"},e.prototype._toggleBranchSelection=function(){return this.$(".branch-wrapper .branches").toggle(),!1},e.prototype.initialize=function(){},e.prototype._search=function(){return _.delay(_.bind(function(){var t;return t=this.$("#search_str").val(),this.model=o(this.model.tree,app.state.path,t),this.renderResults()},this),10)},e.prototype._loading=function(t){return $(t.currentTarget).addClass("loading")},e.prototype.semantifyPaths=function(t){return _.map(t,function(t){return{path:t,name:t}})},e.prototype.renderResults=function(){var t,e;return this.$("#files").html(app.templates.files(_.extend(this.model,app.state,{current_path:app.state.path}))),t=this.model.files.length+"",e=this.$("#search_str").val(),t+=e?" matches":" files",this.$(".results").html(t)},e.prototype.render=function(){var t=this;return this.$el.html(app.templates.posts(_.extend(this.model,app.state,{current_path:app.state.path}))),_.delay(function(){return t.renderResults(),$("#search_str").focus()},1),this},e}(Backbone.View),app.views.Profile=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return k(e,t),e.prototype.id="start",e.prototype.render=function(){return $(this.el).html(app.templates.profile(this.model)),this},e}(Backbone.View),app.views.Start=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return k(e,t),e.prototype.id="start",e.prototype.events={"submit #login_form":"_login"},e.prototype._login=function(){var t,e,r;return e=this,r=e.$("#github_user").val(),t=e.$("#github_password").val(),login({username:r,password:t},function(t){return t?e.$(".bad-credentials").show():window.location.reload()}),!1},e.prototype.render=function(){return $(this.el).html(app.templates.start(this.model)),window.authenticated||$("#header").hide(),this},e}(app.views.Profile),app.routers.Application=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return k(e,t),e.prototype.initialize=function(){return this.route(/(.*\/.*)/,"path",this.path),this.route(":user","user",this.profile),this.route(":user/:repo","repo",this.repo),this.route("","start",this.start)},e.prototype.start=function(){return confirmExit()?(app.state={user:"",repo:"",mode:"",branch:"",path:""},null!=app.config.rootUrl?this.navigate(app.config.rootUrl,!0):app.instance.start()):void 0},e.prototype.extractURL=function(t){return t=t.split("/"),app.state={user:t[0],repo:t[1],mode:t[2],branch:t[3],path:(t.slice(4)||[]).join("/")},app.state},e.prototype.path=function(t){var e;return t=this.extractURL(t),"tree"===t.mode?app.instance.posts(t.user,t.repo,t.branch,t.path):"new"===t.mode?app.instance.newPost(t.user,t.repo,t.branch,t.path):(e=_.extractFilename(t.path),app.state.file=e[1],app.instance.post(t.user,t.repo,t.branch,e[0],e[1],t.mode))},e.prototype.repo=function(t,e){return app.state={user:t,repo:e,mode:"tree",branch:"",path:""},app.instance.posts(t,e)},e.prototype.profile=function(t){return confirmExit()?(app.state={user:t,repo:"",mode:"",branch:"",path:""},app.instance.profile(t)):void 0},e}(Backbone.Router),_.serial=function(){return _(arguments_).reduceRight(_.wrap,function(){})()},_.parentPath=function(t){return t.replace(/\/?[a-zA-Z0-9_-]*$/,"")},_.topPath=function(t){var e;return e=t.match(/\/?([a-zA-Z0-9_-]*)$/),e[1]},_.validFilename=function(t){return!!t.match(/^([a-zA-Z0-9_-]|\.)+$/)},_.validPathname=function(t){return _.all(t.split("/"),function(t){return _.validFilename(t)})},_.extractFilename=function(t){var e;return t.match(/\//)?(e=t.match(/(.*)\/(.*)$/),[e[1],e[2]]):["",t]},_.mode=function(t){var e;if(_.markdown(t))return"gfm";switch(e=_.extension(t)){case"js":case"json":return"javascript";case"html":return"htmlmixed";case"rb":return"ruby";case"yml":return"yaml";case"clj":return"clojure";case"coffee":case"cake":return"coffeescript";case"java":case"c":case"cpp":case"cs":case"php":return"clike"}return e},_.jekyll=function(t,e){return!(!t.match("_posts")||!_.markdown(e))},_.hasMetadata=function(t){return t.match(/^(---\n)((.|\n)*?)\n---\n?/)},_.extension=function(t){var e;return e=t.match(/\.(\w+)$/),e?e[1]:null},_.markdown=function(t){var e;return e=RegExp(".(md|mkdn?|mdown|markdown)$"),!!e.test(t)},_.clip=function(t,e){var r;return r=t.substr(0,e),t.length>e&&(r+=" ..."),r},_.filepath=function(t,e){return(t?t+"/":"")+e},_.toYAML=function(t){var e;return e=[],_.each(t,function(t,r){var n;return t.match(/\n/)?(n=r+": |\n",_.each(t.split("\n"),function(t){return n+="  "+t}),e.push()):e.push(r+": "+t)}),e.join("\n")},_.fromYAML=function(t){var e,r,n,a,o,i;return e=function(){var t,e;return n[t]=_.isArray(e)?e.join("\n"):e,t=null,e=""},n={},o=t.split("\n"),a=null,i="",r=!1,_.each(o,function(t){var n;return n=t.match(/^([A-Za-z_][A-Za-z0-9_]*):\s*(.*)$/),n&&a&&e(),n?(a=n[1],i=n[2],i.match(/\|$/)?(r=!0,i=""):void 0):(_.isArray(i)||(i=[]),r?i.push(t.trim()):i.push(t.replace(/^\s\s/,"")))}),e(),n},_.chunkedPath=function(t){var e;return e=t.split("/"),_.map(e,function(t,r){var n,a;for(a=[],n=0;r>=n;)a.push(e[n]),n++;return{url:a.join("/"),name:t}})},s=function(){return new Github({token:$.cookie("oauth-token"),username:$.cookie("username"),auth:"oauth"})},g=function(){var t,e,r,n,a;for(t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",a=8,r="",e=0;a>e;)n=Math.floor(Math.random()*t.length),r+=t.substring(n,n+1),e++;return r},i=function(t,e){var r;return app.currentRepo.user===t&&app.currentRepo.repo===e?app.currentRepo.instance:(r={user:t,repo:e,instance:s().getRepo(t,e)},r.instance)},t=function(){var t;return $.cookie("oauth-token")?window.authenticated=!0:(t=window.location.href.match(/\?code=([a-z0-9]*)/),t?($.getJSON("{{site.gatekeeper_url}}/authenticate/"+t[1],function(e){var r;return $.cookie("oauth-token",e.token),window.authenticated=!0,r=RegExp("\\?code="+t[1]),window.location.href=window.location.href.replace(r,"").replace("&state=","")}),!1):!0)},f=function(){return window.authenticated=!1,$.cookie("oauth-token",null)},p=function(t){return window.authenticated?$.ajax({type:"GET",url:"https://api.github.com/user",dataType:"json",contentType:"application/x-www-form-urlencoded",headers:{Authorization:"token "+$.cookie("oauth-token")},success:function(e){var r,n;return $.cookie("avatar",e.avatar_url),$.cookie("username",e.login),app.username=e.login,n=s().getUser(),r={},n.repos(function(e,a){return n.orgs(function(e,n){return _.each(a,function(t){return r[t.owner.login]=r[t.owner.login]?r[t.owner.login].concat([t]):[t]}),t(null,{available_repos:a,organizations:n,owners:r})})})},error:function(){return t("error",{available_repos:[],owners:{}})}}):t(null,{available_repos:[],owners:{}})},d=function(t,e){var r;return r=s().getUser(),r.show(t,function(n,a){var o;return o={},"user"===a.type.toLowerCase()?r.userRepos(t,function(t,r){return e(null,{repos:r,user:a})}):r.orgRepos(t,function(t,r){return e(null,{repos:r,user:a})})})},u=function(t,e,r){return e=i(t,e),e.listBranches(function(t,e){return r(t,e)})},o=function(t,e,r){var n,a,o,i;return a=function(t){var n;return t.path===e?!1:(n=t.path.match(RegExp("^"+e+"(.*)$")),n?!!r||(e?2:1)>=n[1].split("/").length:!1)},o=function(t){return r?t.path.toLowerCase().search(r.toLowerCase())>=0:!0},i=0,n=_.filter(t,function(t){var n;return n=RegExp("("+r+")","i"),t.name=r?t.path:_.extractFilename(t.path)[1],t.name=t.name.replace(RegExp("^"+e+"/?"),""),t.name=t.name.replace(n,"<b>$1</b>"),a(t)?(i+=1,o(t)):!1}),n=_.sortBy(n,function(t){return("tree"===t.type?"A":"B")+t.path}),{tree:t,files:n,total:i}},h=function(t,e,r,n,a){var s,p,c;return p=function(t){return c.read(r,"_config.yml",function(e,r){return e?t(e):t(null,jsyaml.load(r))})},s=function(){return p(function(i,s){var p;return app.state.jekyll=!i,app.state.config=s,p=s&&s.prose&&s.prose.rooturl?s.prose.rooturl:"",n||(n=p),c.getTree(r+"?recursive=true",function(i,s){return i?a("Not found"):u(t,e,function(t,e){return t?a("Branches couldn't be fetched"):(app.state.path=n?n:"",app.state.branches=_.filter(e,function(t){return t!==r}),a(null,o(s,n,"")))})})})},c=i(t,e),c.show(function(t,e){return r||(app.state.branch=r=e.master_branch),app.state.permissions=e.permissions,s()})},y=function(t,e){return e?["---",e,"---"].join("\n")+"\n\n"+t:t},w=function(t,e,r,n,a,o,s){return e=i(t,e),e.write(r,n,a,o,s)},a=function(t,e,r,n){var a,o,s;return o=function(t){return _.delay(function(){return a.contents("",function(e,r){return r?t():o(t)})},500)},s=i(t,e),a=i(app.username,e),s.fork(function(){return o(function(){return s.getRef("heads/"+r,function(t,e){return a.listBranches(function(t,r){var o,i;for(o=1;-1!==$.inArray("prose-patch-"+o,r);)o++;return i={ref:"refs/heads/prose-patch-"+o,sha:e},a.createRef(i,n)})})})})},e=function(t,e,r,n){return e=i(t,e),e.createPullRequest(r,function(){return n()})},v=function(t,r,n,o,i,s,p){return a(t,r,n,function(t,a){return n=a.ref.substring(a.ref.lastIndexOf("/")+1),w(app.username,r,n,o,i,s,function(t){var r;return t?p(t):(r={title:s,body:"This pull request has been automatically generated by Prose.io.",base:app.state.branch,head:app.username+":"+n},e(app.state.user,app.state.repo,r,p))})})},r=function(t,e,r,n,a,o){return e=i(t,e),e.remove(r,_.filepath(n,a),o)},m=function(t,e,r,n,a,o){return e=i(t,e),e.move(r,n,a,o)},n=function(t,e,r,n,a){var o,i,s;if(s="layout: default\npublished: false",i={layout:"default",published:!1},o=app.state.config,o&&o.prose&&o.prose.metadata&&o.prose.metadata[n]){s=o.prose.metadata[n];try{i=jsyaml.load(s)}catch(p){console.log("ERROR encoding YAML")}}return a(null,{metadata:i,raw_metadata:s,content:"# How does it work?\n\nEnter Text in Markdown format.",repo:e,path:n,published:!1,persisted:!1,writeable:!0,file:(new Date).format("Y-m-d")+"-your-filename.md"})},l=function(t,e,r,n,a,o){return e=i(t,e),e.read(r,n?n+"/"+a:a,function(t,r,i){var s,p,u;return u=function(t){return!!t.match(/published: true/)},s=function(t){var e,r;return r=function(){return!(!app.state.permissions||!app.state.permissions.push)},t=t.replace(/\r\n/g,"\n"),_.hasMetadata(t)?(e={raw_metadata:"",published:!1,writeable:r()},e.content=t.replace(/^(---\n)((.|\n)*?)\n---\n?/,function(t,r,n){return e.raw_metadata=n,e.published=u(n),""}).trim(),e):{raw_metadata:"",content:t,published:!1,writeable:r()}},t?o(t):(p=s(r),o(t,_.extend(p,{sha:i,markdown:_.markdown(a),jekyll:_.hasMetadata(r),repo:e,path:n,file:a,persisted:!0})))})},app.currentRepo={user:null,repo:null,instance:null},t(),window.confirmExit=function(t){var e;return null==window.app.instance.mainView?!0:window.app.instance.mainView.dirty?(e="You have unsaved changes. Are you sure you want to leave?",null!=t&&null!=t.type&&"beforeunload"===t.type?e:confirm(e)):!0},window.onbeforeunload=function(t){var e;return e=confirmExit(t),c===!0?null:(t=t||window.event,t&&(t.returnValue=e),e)},p(function(t,e){return window.app.instance=new app.views.Application({el:"#container",model:e}).render(),t?app.instance.notify("error","Error while loading data from Github. This might be a temporary issue. Please try again later."):(window.router=new app.routers.Application,Backbone.history.start())})}).call(this);